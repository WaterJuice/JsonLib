////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//  WjTestLib
//
//  A simple unit test framework.
//
//  This is free and unencumbered software released into the public domain - November 2019 waterjuice.org
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//  IMPORTS
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

#include "WjTestLib.h"
#include <stdint.h>
#include <stdlib.h>
#include <stdbool.h>
#include <stdio.h>

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//  TYPES
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//  GLOBALS
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

static  uint64_t        gNumAsserts     = 0;
static  uint64_t        gNumAssertFails = 0;

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//  PUBLIC FUNCTIONS - Declarations in WjTestLib.h
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//  PUBLIC FUNCTIONS
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//  WjTestLib_Asserts_Reset
//
//  Resets the number of asserts and assert fails (stored as globals). This must be called before each test
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
void
    WjTestLib_Asserts_Reset
    (
        void
    )
{
    gNumAsserts     = 0;
    gNumAssertFails = 0;
}

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//  WjTestLib_Asserts_GetStats
//
//  Gets the number of asserts and assert fails since the last call to WjTestLib_Asserts_Reset
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
void
    WjTestLib_Asserts_GetStats
    (
        uint64_t*       pNumAsserts,            // OPTIONAL
        uint64_t*       pNumAssertFails         // OPTIONAL
    )
{
    if( NULL != pNumAsserts )
    {
        *pNumAsserts = gNumAsserts;
    }
    if( NULL != pNumAssertFails )
    {
        *pNumAssertFails = gNumAssertFails;
    }
}

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//  WjTestLib_Assert
//
//  Records an assert (success if Condition is true, fail if false) for the test executing.
//  Use WJTL_ASSERT macro rather than calling this directly
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
void
    WjTestLib_Assert
    (
        bool            Condition,
        char const*     ConditionString,
        char const*     FileName,
        char const*     FunctionName,
        int             LineNumber
    )
{
    gNumAsserts += 1;

    if( !Condition )
    {
        gNumAssertFails += 1;

        printf(
            "ASSERT FAIL: %s : %s (Line %d)\n"
            "CONDITION: \"%s\"\n",
            FileName, FunctionName, LineNumber,
            ConditionString );
    }
}
